# Helper scripts
These scripts may be helpful in creating a single-cell dataset.
To see all arguments and options for each script, use `python SCRIPT.py --help`


## array_to_sc.py
Generate a single-cell dataset from a methylation profile (created from purified samples).
See the Jupyter Notebook [scaden_pipeline_example.ipynb](../scaden_pipeline_example.ipynb), section "From a methylation profile" for an example.


## scMap-mem.py
This program takes the methylation data of one cell, and maps the loci to CpGs from an array (e.g., Illumina Infinium HumanMethylation450 or MethylationEPIC).

- The single cell data should be allc files with 7 columns (chromosome, position, strand, class, mC reads, total reads, methylated). This data can be a single file tsv file(including compressed files, e.g. .tsv.gz), a directory containing tsv files, or a tarball containing tsv files. Whichever is used, this data should be only for a single cell.
    - See the `helper_scripts/data/cells/` directory for three examples of methylC-seq data taken from [GSE97179](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE97179).
- The array data should be in a .bed or .tsv file without a header but with the columns chrom, chromStart, chromEnd, name, score, strand.
    - See the `helper_scripts/data/array/` directory for two example array files.

Some notes about the `-a` flag:
    - Use it if you see the error 'ValueError: You are trying to merge on object and int64 columns...'
    - Don't use it if you see the warning 'DtypeWarning: Columns (1,4,5,6) have mixed types...'

The output will be a bed file containing the chromosome locations, CpG names, strand, and scores (with the columns chrom, chromStart, chromEnd, name, score, strand).

Example usage:
```
python scMap-mem.py -s -o data/Pool_1000_AD002_indexed.tar.gz.bed data/array/450k_array_sorted.bed data/cells/Pool_1000_AD002_indexed.tar.gz
```


## scMap-bedops.py
This program does the same thing as scMap-mem.py, but requires [bedops](https://bedops.readthedocs.io) to be installed in order to allow the mapping to be done over a range of values. If you are only mapping CpGs to a single base pair, use scMap-mem.py instead since it's faster.

NOTE: This version is behind scMap-mem. There may be bugs.


## cells_to_matrix.py
This takes a folder/pattern of cells from scMap-*.py and combines the scores into a single large file.

Example usage:
```
python cells_to_matrix.py -o data/cell_matrix.txt 'data/cells/*.bed'
```

## h5ad_extract.py
This takes an h5ad file generated by scaden simulate and extracts the counts and fractions as tsv files. 
```
python h5ad_extract.py -p example data/example.h5ad data/
```